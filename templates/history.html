{% extends "base.html" %}

{% block title %}My History{% endblock %}

{% block content %}
<div class="container">
    <h2>My Booking History</h2>

    {% if bookings %}
    <div class="listings-grid">
        {% for booking in bookings %}
        <div class="listing-card">
            <h4>{{ booking.listing.title }}</h4>
            <p class="location">üìç {{ booking.listing.location }}</p>
            <p><strong>Time:</strong> {{ booking.start_time.strftime('%Y-%m-%d %H:%M') }} to {{
                booking.end_time.strftime('%H:%M') }}</p>
            <p><strong>Total:</strong> ${{ "%.2f"|format(booking.total_price) }}</p>
            <p>
                <strong>Status:</strong>
                <span style="color: {{ 'var(--secondary)' if booking.status == 'cancelled' else '#10b981' }}">
                    {{ booking.status|upper }}
                </span>
                ({{ booking.payment_status|upper }})
            </p>

            {% if booking.status != 'cancelled' and booking.start_time > now %}
            <form action="{{ url_for('cancel_booking', booking_id=booking.id) }}" method="POST"
                style="margin-top: 1rem;">
                <button type="submit" class="btn-secondary"
                    style="background: rgba(239, 68, 68, 0.2); color: #fca5a5; width: 100%;">Cancel Booking</button>
            </form>
            {% endif %}

            {% if booking.status == 'confirmed' and booking.end_time < now %} <hr
                style="border-color: rgba(255,255,255,0.1); margin: 1rem 0;">
                <h5>Leave a Review</h5>
                <form action="{{ url_for('add_review', listing_id=booking.listing.id) }}" method="POST">
                    <div class="form-group">
                        <select name="rating" required
                            style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); color: white; border-radius: 0.5rem;">
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5)</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4)</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê (3)</option>
                            <option value="2">‚≠ê‚≠ê (2)</option>
                            <option value="1">‚≠ê (1)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <textarea name="comment" placeholder="How was your parking experience?" rows="2"
                            style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); color: white; border-radius: 0.5rem;"></textarea>
                    </div>
                    <button type="submit" class="btn-secondary btn-sm" style="width: 100%;">Submit Review</button>
                </form>
                {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No bookings found.</p>
    {% endif %}
</div>
{% endblock %}